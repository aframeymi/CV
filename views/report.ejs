<!DOCTYPE html>
<html lang="en">

  <%- include('includes/head') %>

  <body>
    <%- include('includes/navbar') %>

    <div class="image-container">
      <img src="/reportimg.jpg" width="100%" height="500px">
    </div>

    <div class="report-form">
      <h1>Record a Report</h1>
      <form id="reportForm" method="post" action="/submit-report" autocomplete="off" enctype="multipart/form-data">
        <input type="text" id="title" name="title" placeholder="Title" required>
        <textarea id="description" name="description" placeholder="Write details in here..." required></textarea>
        <label for="city">City</label>
        <select id="city" name="city" required>
          <option value="">Select a city</option>
          <% if (typeof cities !== 'undefined' && Array.isArray(cities)) { %>
            <% cities.forEach(c => { %>
              <option value="<%= c.id %>"><%= c.name %></option>
            <% }) %>
          <% } %>
        </select>
        <label for="neighborhoodId">Neighborhood</label>
        <select id="neighborhoodId" name="neighborhoodId" required disabled>
          <option value="">Select a neighborhood</option>
        </select>
        <div class="file-upload">
          <input type="file" id="image" name="image" accept="image/*">
        </div>
        <button type="submit">SUBMIT</button>
      </form>
    </div>

    <div class="map-container">
      <iframe class="map" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d313275.8136508344!2d13.09510018575723!3d52.506386175110244!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47a84e373f035901%3A0x42120465b5e3b70!2sBerlin!5e1!3m2!1sen!2sde!4v1740049865470!5m2!1sen!2sde"
              width="50%" height="350px" style="border:0; margin: -5px;" allowfullscreen="" loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>

    <script>
      const citiesData = <%- JSON.stringify(cities || []) %>;

      const citySelect = document.getElementById('city');
      const nbhSelect = document.getElementById('neighborhoodId');

      citySelect.addEventListener('change', () => {
        const cityId = citySelect.value;
        nbhSelect.innerHTML = '<option value="">Select a neighborhood</option>';
        nbhSelect.disabled = true;

        if (!cityId) return;
        const city = citiesData.find(c => c.id === cityId);
        if (city && Array.isArray(city.neighborhoods)) {
          city.neighborhoods.forEach(n => {
            const opt = document.createElement('option');
            opt.value = n.id;
            opt.textContent = n.name;
            nbhSelect.appendChild(opt);
          });
          nbhSelect.disabled = false;
        }
      });
      document.getElementById('reportForm').addEventListener('submit', () => {
    if (nbhSelect.disabled) nbhSelect.disabled = false;
  });
    </script>

  </body>
</html>
